
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main(int argc, char **argv) {
  FILE *fd;
  char fName[200];
  int pin;

  if (argc==1) {
    printf("Syntax: artik pin set in/out\n");
    printf("    or: artik pin get/'a value to set'\n");
    return 0;
  }
  pin=atoi(argv[1]);
  if (strcmp(argv[2],"set")==0) {
    printf("Will do a SET!\n");
    if (strcmp(argv[3],"in")!=0 && strcmp(argv[3],"out")!=0) {
      printf("Need either the word 'in' or 'out'!\n");
      return -1;
    }
    if (strcmp(argv[3],"out")==0 || strcmp(argv[3],"in")==0) {
      int result;
      printf("First requesting the pin by writing to export");
      sprintf(fName,"/sys/class/gpio/export");
      fd=fopen(fName,"w");
      printf("Export fd is %d\n",fd);
      result=fprintf(fd,"%d\n",pin);
      printf("Result of the export write: %d to fName:%s to pin:%d\n",result,fName,pin);
      fclose(fd);
      printf("Doing a set for %s\n",argv[3]);
      sprintf(fName,"/sys/class/gpio/gpio%d/direction",pin);
      printf("fname %s argv3:%s\n",fName,argv[3]);
      fd=fopen(fName,"w");
      printf("fd:%d\n",fd);
      fprintf(fd,argv[3]);
      printf("Done!");
    }
    return 0;
  }
  if (strcmp(argv[2],"get")!=0) {
    int result;
    printf("Appears we are going to SET a value to the pin!\n");
    sprintf(fName,"/sys/class/gpio/gpio%d/value",pin);
    printf("Will write to %s\n",fName);
    fd=fopen(fName,"w");
    printf("FD is %d\n",fd);
    result=fprintf(fd,"%s\n",argv[2]);
    printf("Result of write is %d\n",result);
    fclose(fd);
    return 0;
  }
  
  if (strcmp(argv[2],"get")==0) {
    char value[100];
    printf("will do a get of pin %d\n",pin);
    sprintf(fName,"/sys/class/gpio/gpio%d/value",pin);
    fd=fopen(fName,"r");
    value[1]=0;
    fread(value,1,1,fd);
    printf("Value:%s\n",value);
    fclose(fd);
    return 0;
  }  
  printf("Unknown command!");
  return -1;
  /*


  
  fd=fopen("/sys/class/gpio/export","w");
  printf("hi fd:%d\n",fd);
  fprintf(fd,"1\n");
  */
}
